<!DOCTYPE html>
<html lang="en">
<!--I don't know what I'm doing, feel free to message me with bugfixes-->

<head>
    <link rel="stylesheet" href="./assets/style.css">
    <link rel="stylesheet" href="./assets/stylep2.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>WebDesk</title>
    <script>
        var ver = "0.0.9";
        var lastedit = "April 29, 2024";
        var locked = false;
        var fname;
        var fblob;
        var nvol = 1.0;
        var copied;
        var copiedn;
        var sdone = false;
    </script>
</head>

<body>
    <div id="deathcurtain"
        style="z-index: 9999; position: fixed; left: 0px; top: 0px; bottom: 0px; right: 0px; background-color: #000;">
    </div>
    <div id="prohibit"
        style="z-index: 9999; position: fixed; left: 0px; top: 0px; bottom: 0px; right: 0px; background-color: #000; display: none;">
        <div style="position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%);">
            <img src="./assets/img/warn.svg" style="width: 100px; margin-bottom: 3px; filter: invert(1);"></img>
            <p><a class="bold" id="perr" href="https://errdesk.vercel.app?e=what"
                    style="color: #fff !important;">errdesk.vercel.app</a></p>
        </div>
    </div>
    <div id="oobespace">
        <div id="setupbg" onmousedown="unlock('setupbg');">
            <div id="sorryapple">
                <svg id="hellosvg" viewBox="0 0 1230.94 414.57">
                    <path
                        d="M-293.58-104.62S-103.61-205.49-60-366.25c9.13-32.45,9-58.31,0-74-10.72-18.82-49.69-33.21-75.55,31.94-27.82,70.11-52.22,377.24-44.11,322.48s34-176.24,99.89-183.19c37.66-4,49.55,23.58,52.83,47.92a117.06,117.06,0,0,1-3,45.32c-7.17,27.28-20.47,97.67,33.51,96.86,66.93-1,131.91-53.89,159.55-84.49,31.1-36.17,31.1-70.64,19.27-90.25-16.74-29.92-69.47-33-92.79,16.73C62.78-179.86,98.7-93.8,159-81.63S302.7-99.55,393.3-269.92c29.86-58.16,52.85-114.71,46.14-150.08-7.44-39.21-59.74-54.5-92.87-8.7-47,65-61.78,266.62-34.74,308.53S416.62-58,481.52-130.31s133.2-188.56,146.54-256.23c14-71.15-56.94-94.64-88.4-47.32C500.53-375,467.58-229.49,503.3-127a73.73,73.73,0,0,0,23.43,33.67c25.49,20.23,55.1,16,77.46,6.32a111.25,111.25,0,0,0,30.44-19.87c37.73-34.23,29-36.71,64.58-127.53C724-284.3,785-298.63,821-259.13a71,71,0,0,1,13.69,22.56c17.68,46,6.81,80-6.81,107.89-12,24.62-34.56,42.72-61.45,47.91-23.06,4.45-48.37-.35-66.48-24.27a78.88,78.88,0,0,1-12.66-25.8c-14.75-51,4.14-88.76,11-101.41,6.18-11.39,37.26-69.61,103.42-42.24,55.71,23.05,100.66-23.31,100.66-23.31"
                        transform="translate(311.08 476.02)"
                        style="fill:none;stroke:#fff;stroke-linecap:round;stroke-miterlimit:10;stroke-width:35px" />
                </svg>
                <p class="med"
                    style="font-size: 15px; margin-top: 8px; color: #fff; margin-top: 8px; animation: fucker 4.3s;">
                    Press to open</p>
            </div>
        </div>
        <div class="setup" style="width: 500px; height: 360px;">
            <div
                style="width: 100%; border: 1px solid var(--lightdark3); box-sizing: border-box; display: flex; align-items: center;
            justify-content: space-between; padding: 2px; border-radius: var(--rad2); text-align: left; margin-bottom: 6px;">
                <div class="tnav"><button class="b4" onclick="eprompt();">Start Over</button></div>
                <div class="title"><button class="time b4"
                        style="background-color: transparent !important;">--:--</button></div>
            </div>
            <div id="setup1" class="setupp">
                <p class="h3">Welcome to WebDesk!</p>
                <button class="b1" onclick="guestmode();">Guest</button><button class="b1"
                    onclick="fesw('setup1', 'setup2');">Let's go!</button>
            </div>
            <div id="setup2" class="hide setupp">
                <p class="h3">Encryption</p>
                <p>Being unencrypted is significantly faster, but data isn't secured.</p>
                <p>Encryption keeps your data safe behind a password.</p>
                <button class="b1" onclick="fesw('setup2', 'setup1');">Back</button><button class="b1"
                    onclick="writepb('enc', 'y');fesw('setup2', 'setups');">Encrypt</button><button class="b1"
                    onclick="writepb('enc', 'n');fesw('setup2', 'setupqs');">Don't encrypt</button>
            </div>
            <div id="setupqs" class="hide setupp">
                <p class="h3">Quick Start</p>
                <p>If you have an existing WebDesk, you can copy your data over instantly.</p>
                <p>On the other WebDesk, go to Settings -> Migrate Away -> and enter the code below:</p>
                <p class="h2 mcode">----</p>
                <button class="b1" onclick="fesw('setupqs', 'setup1');">Back</button><button class="b1"
                    onclick="fesw('setupqs', 'setupn');">No thanks</button>
            </div>
            <div id="setuprs" class="hide setupp">
                <p class="h3">Restoring...</p>
                <p>Please wait. This might take a while depending on file size and encryption.</p>
                <p class="restpg">Starting restore...</p>
            </div>
            <div id="setups" class="hide setupp">
                <p class="h3">Password Setup</p>
                <p>Enter a password to decrypt WebDesk with.</p>
                <p>Don't lose this password, as your data is gone without it.</p>
                <input class="i1" type="password" id="oobep" placeholder="Password here"></input>
                <button class="b1"
                    onclick="const p = document.getElementById('oobep').value; pass = p; fesw('setups', 'setupqs');">Set
                    password, next!</button>
            </div>
            <div id="setupn" class="hide setupp">
                <p class="h3">User Setup</p>
                <p>Enter a username to use with WebDesk.</p>
                <input class="i1" id="ooben" placeholder="Username here"></input>
                <button class="b1"
                    onclick="const n = document.getElementById('ooben').value; writef('/user/info/name', n);fesw('setupn', 'setupc');">Set
                    username, next!</button>
            </div>
            <div id="setupc" class="hide setupp">
                <p class="h3">Appearance</p>
                <p>Select an accent color, and a theme.</p>
                <p class="bold">Accent color</p>
                <button class="acb" style="background: rgb(210, 30, 30);" onclick="chacc('210, 30, 30');"></button>
                <button class="acb" style="background: rgb(210, 120, 30);" onclick="chacc('210, 120, 30');"></button>
                <button class="acb" style="background: rgb(210, 180, 20);" onclick="chacc('210, 180, 20');"></button>
                <button class="acb" style="background: rgb(50, 160, 20);" onclick="chacc('50, 160, 20');"></button>
                <button class="acb" style="background: rgb(40, 70, 235);" onclick="chacc('40, 70, 235');"></button>
                <button class="acb" style="background: rgb(120, 60, 235);" onclick="chacc('120, 60, 235');"></button>
                <button class="acb" style="background: rgb(180, 180, 180);" onclick="chacc('200, 200, 200');"></button>
                <p class="bold">Theme</p>
                <button class="b1 b2" onclick="appear('l');">Light mode</button>
                <button class="b1 b2" onclick="appear();">Dark mode</button>
                <button class="b1" onclick="fesw('setupc', 'setupl');setupd();">Done</button>
            </div>
            <div id="setupl" class="hide setupp">
                <p class="h3">Location Services</p>
                <p>You can optionally enable Location Services, to update the weather in your location, use certain
                    weather info to dynamically adjust WebDesk, and possibly more in the future.</p>
                <p>At the moment, your location is only processed through OpenWeatherMap. This info is not sent or
                    collected by WebDesk.</p>
                <input class="i1" placeholder="Enter your country and city" id="oobeloc"></input>
                <button class="b1" onclick="fesw('setupl', 'setupf');">No thanks</button><button class="b1"
                    onclick="fesw('setupl', 'setupf'); writef('/user/info/city', document.getElementById('oobeloc').value);">Done</button>
            </div>
            <div id="setupf" class="hide setupp">
                <p class="h3">Setup is done!</p>
                <p>Click "Reboot" to finish. Have fun!</p>
                <button class="b1 b2" onclick="reboot(200);">Reboot</button>
            </div>
            <div id="setupa" class="hide setupp">
                <p class="authcont">Enter password to continue.</p>
                <input id="authp" class="i1" type="password" placeholder="Password here"></input>
                <button class="b1" onclick="eprompt();">I forgot</button><button class="b1"
                    onclick="authg();">OK</button>
            </div>
        </div>
    </div>
    <div class="window" id="filem" style="width: 400px;">
        <div class="d tb">
            <div class="tnav">
                <div class="winb red" onmousedown="clapp('filem');"></div>
                <div class="winb yel" onmousedown="mini('filem');"></div>
                <div class="winb gre" onmousedown="max('filem');"></div>
            </div>
            <div class="title">Files</div>
        </div>
        <div class="content">
            <div id="breadcrumbs"></div>
            <div id="directoryContents"></div>
        </div>
    </div>
    <div class="window" id="term" style="width: 280px;">
        <div class="d tb">
            <div class="tnav">
                <div class="winb red" onmousedown="clapp('term');"></div>
                <div class="winb yel" onmousedown="mini('term');"></div>
                <div class="winb gre" onmousedown="max('term');"></div>
            </div>
            <div class="title">Terminal</div>
        </div>
        <div class="content">
            <input class="i1" id="termbox" placeholder="Enter JS code here"></i1>
            <button class="b1" onclick="document.getElementById('termbox').value = '';">Clear</button><button class="b1"
                onclick="const t = document.getElementById('termbox').value;eval(t);snack('Executed.', 2500);">Execute!</button>
        </div>
    </div>
    <div class="window" id="sendf" style="width: 280px;">
        <div class="d tb">
            <div class="tnav">
                <div class="winb"></div>
                <div class="winb"></div>
                <div class="winb"></div>
            </div>
            <div class="title">ID is <span class="mcode med">----</span></div>
        </div>
        <div class="content">
            <p>Sending "<span class="med fname">undefined</span>"</p>
            <p class="smt">Go to the other WebDesk, open "Recieve", and type the ID below, then hit "Send".</p>
            <input id="sendi" placeholder="Enter DeskID" class="i1"></input>
            <button class="b1" onclick="fname = undefined; fblob = undefined; clapp('sendf');">Cancel</button><button
                class="b1" onclick="sendf(document.getElementById('sendi').value);">Send</button>
        </div>
    </div>
    <div class="window" id="recif" style="width: 280px;">
        <div class="d tb">
            <div class="tnav">
                <div class="winb red" onmousedown="clapp('recif');"></div>
                <div class="winb yel" onmousedown="mini('recif');"></div>
                <div class="winb gre" onmousedown="max('recif');"></div>
            </div>
            <div class="title">Recieve</div>
        </div>
        <div class="content">
            <p>Your DeskID is</p>
            <p class="h2 mcode">----</p>
            <p class="smt">Sharing? Open Files, find what you want to send, select it, and hit "Send".</p>
            <p class="smt">Note: You can also recieve songs from Shuffler.</p>
        </div>
    </div>
    <div class="window" id="settings" style="width: 350px;">
        <div class="d tb">
            <div class="tnav">
                <div class="winb red" onmousedown="clapp('settings');"></div>
                <div class="winb yel" onmousedown="mini('settings');"></div>
                <div class="winb gre" onmousedown="max('settings');"></div>
            </div>
            <div class="title">Settings</div>
        </div>
        <div class="content">
            <div id="settmain">
                <button class="b1 b2" onclick="fesw('settmain', 'settapp');">Appearance</button>
                <button class="b1 b2" onclick="fesw('settmain', 'settmig');">Migrate Away</button>
                <button class="b1 b2" onclick="fesw('settmain', 'settgen');">General</button>
            </div>
            <div id="settapp" class="hide">
                <p class="h3">Appearance</p>
                <p class="med">Accent color</p>
                <button class="acb" style="background: rgb(210, 30, 30);" onclick="chacc('210, 30, 30');"></button>
                <button class="acb" style="background: rgb(210, 120, 30);" onclick="chacc('210, 120, 30');"></button>
                <button class="acb" style="background: rgb(210, 180, 20);" onclick="chacc('210, 180, 20');"></button>
                <button class="acb" style="background: rgb(50, 160, 20);" onclick="chacc('50, 160, 20');"></button>
                <button class="acb" style="background: rgb(40, 70, 235);" onclick="chacc('40, 70, 235');"></button>
                <button class="acb" style="background: rgb(120, 60, 235);" onclick="chacc('120, 60, 235');"></button>
                <button class="acb" style="background: rgb(180, 180, 180);" onclick="chacc('200, 200, 200');"></button>
                <p class="med">Theme</p>
                <button class="b1 b2" onclick="appear('l');">Light mode</button>
                <button class="b1 b2" onclick="appear();">Dark mode</button>
                <button class="b1" onclick="fesw('settapp', 'settmain');">Back</button>
            </div>
            <div id="settgen" class="hide">
                <p>General</p>
                <button class="b1 b2" onclick="idch();">Change
                    DeskID</button>
                <button class="b1 b2" onclick="eprompt();">Erase WebDesk</button>
                <button class="b1 b2" onclick="window.location.href = './rec.html';">Recovery (Reboot)</button>
                <button class="b1" onclick="fesw('settgen', 'settmain');">Back</button>
            </div>
            <div id="settmig" class="hide">
                <p>Migration</p>
                <p>Enter the ID shown on the other WebDesk below, and hit "Move".</p>
                <p>Migration can take 2 seconds to several hours, depending on how much data you have.</p>
                <input class="i1" id="maway" placeholder="ID here..."></input>
                <button class="b1" onclick="fesw('settmig', 'settmain');">Back</button><button class="b1"
                    onclick="migaway(document.getElementById('maway').value);">Move</button>
            </div>
        </div>
    </div>
    <div id="menubar">
        <div class="tnav">
            <button class="mb bold"
                onclick="cm(`<button onclick='upload();' class='b1 b2'>Add File</button><button onclick='reboot(300);' class='b1 b2'>Reboot WebDesk</button><button class='b1'>Close</button>`);">WebDesk</button>
        </div>
        <div class="title">
            <img src="./assets/img/no.svg" id="bi"></img>
            <button class="mb time">--:--</button>
        </div>
    </div>
    <div id="gomenu">
        <p>Hello, <span class="uname"></span>!</p>
        <button class="b1 b2" onclick="about();">About</button>
        <button class="b1 b2" onclick="opapp('filem', 'Files', './assets/img/apps/files.svg');dfm('/');">Files</button>
        <button class="b1 b2" onclick="opapp('term', 'Terminal');">Terminal</button>
        <button class="b1 b2" onclick="opapp('recif', 'Recieve', './assets/img/apps/recieve.svg');">Recieve</button>
        <button class="b1 b2"
            onclick="opapp('settings', 'Settings', './assets/img/apps/settings.svg');">Settings</button>
        <button class="b1" onclick="toggle('gomenu');">Close</button>
    </div>
    <div id="taskbar"><img class="tbi" onclick="toggle('gomenu');" src="./assets/img/launch.svg"></img><span
            id="taskbara"></span></div>
    <script src="./assets/lib/jszip.js"></script>
    <script src="./assets/lib/peer.js"></script>
    <script src="./assets/lib/enc.js"></script>
    <script src="./assets/lib/jq.js"></script>
    <script src="./assets/code/fs.js"></script>
    <script src="./assets/code/misc.js"></script>
    <script src="./assets/code/core.js"></script>
    <script src="./assets/code/init.js"></script>
    <script src="./assets/code/send.js"></script>
    <script src="./assets/apps/about.js"></script>
    <script src="./assets/apps/auth.js"></script>
    <script src="./assets/apps/files.js"></script>
    <script>
        async function boots1() {
            try {
                await initializeDB();
                const silly = await readf('/system/setupon');
                const enc = readpb('enc');
                if (silly !== undefined) {
                    sdone = true;
                    if (enc === "y") {
                        pw('Enter password to continue.', 'boots2()');
                    } else {
                        boots2();
                    }
                } else {
                    if (await readpb('setupdone') === "y") {
                        await writef('/system/setupon', 'Unknown');
                        await boots1();
                        return;
                    }
                    eraseall();
                    showf('setupbg');
                    await writef('/user/info/accent', '100, 5, 255');
                }
                const fucker = gen(4);
                const deskid = readpb('deskid');
                if (deskid === null) {
                    writepb('deskid', fucker);
                    dserv(fucker);
                    console.log(`<!> Created DeskID: ${fucker}`);
                } else {
                    dserv(deskid);
                    console.log(`<i> DeskID exists: ${deskid}`)
                }
                hidef('deathcurtain', 400);
                console.log(`<i> Boot successful!`);
            } catch (error) {
                panic('2', error);
            }
        }

        async function boots2() {
            try {
                dest('oobespace');
                const name = await readf('/user/info/name');
                const appear2 = await readf('/user/info/appear');
                const accent = await readf('/user/info/accent');
                const fucker = await readf('/system/check');
                if (fucker !== "DontModifyOrYouWillBrickWebDesk") {
                    panic('6', '/system/check is corrupted.');
                }
                if (appear2 === "dark") {
                    appear();
                }
                if (accent) {
                    cv('accent', accent);
                }
                masschange('uname', name);
            } catch (error) {
                panic('3', error);
            }
        }

        $(document).ready(boots1);
    </script>
</body>

</html>